# For reference of which states of the 3x2 model are associated with which value, 
# see 3x2-states.png

# Prerequisites
source("Voter-model-simulations.R")

Q <- matrix(data = # 3          # 5          # 7           # 9           # 11         # 13          # 15          # 17          # 19         # 21
   c(25/36, 0    , 0   , 3/36 , 0   , 0    , 2/36 , 0    , 0    , 0    , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 1
     0    , 11/18, 0   , 0    , 0   , 0    , 3/18 , 1/18 , 0    , 0    , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 2
     6/18 , 0    , 7/18, 0    , 0   , 0    , 0    , 0    , 2/18 , 0    , 3/18 , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 3
     3/18 , 0    , 0   , 13/18, 0   , 0    , 0    , 0    , 0    , 2/18 , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 4
     6/18 , 0    , 0   , 0    , 7/18, 0    , 0    , 0    , 0    , 0    , 3/18 , 0   , 0    , 2/18 , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 5
     6/36 , 6/36 , 0   , 0    , 0   , 11/36, 0    , 0    , 0    , 6/36 , 0    , 0   , 4/36 , 3/36 , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 6
     4/36 , 3/36 , 0   , 0    , 0   , 0    , 21/36, 0    , 3/36 , 3/36 , 0    , 0   , 2/36 , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 7
     0    , 2/9  , 0   , 0    , 0   , 0    , 0    , 16/36, 0    , 0    , 0    , 0   , 1/3  , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 8
     0    , 0    , 1/18, 0    , 0   , 0    , 3/18 , 0    , 10/18, 0    , 0    , 0   , 0    , 0    , 3/18 , 0    , 0    , 0    , 0    , 1/18, 0    , 0    , # 9
     0    , 0    , 0   , 4/36 , 0   , 0    , 3/36 , 0    , 0    , 22/36, 0    , 0   , 0    , 0    , 3/36 , 0    , 0    , 0    , 4/36 , 0   , 0    , 0    , # 10
     0    , 0    , 3/36, 6/36 , 3/36, 0    , 0    , 0    , 0    , 0    , 15/36, 0   , 0    , 0    , 4/36 , 3/36 , 2/36 , 0    , 0    , 0   , 0    , 0    , # 11
     0    , 0    , 1/6 , 0    , 0   , 2/6  , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , 0    , 0    , 2/6  , 0    , 0    , 1/6 , 0    , 0    , # 12
     0    , 0    , 0   , 0    , 0   , 2/36 , 4/36 , 3/36 , 0    , 0    , 0    , 0   , 15/36, 0    , 0    , 0    , 0    , 3/36 , 6/36 , 3/36, 0    , 0    , # 13
     0    , 0    , 0   , 0    , 4/36, 3/36 , 6/36 , 0    , 0    , 0    , 0    , 0   , 0    , 10/36, 6/36 , 0    , 3/36 , 4/36 , 0    , 0   , 0    , 0    , # 14
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 3/36 , 3/36 , 2/36 , 0   , 0    , 0    , 21/36, 0    , 0    , 0    , 0    , 0   , 3/36 , 4/36 , # 15
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 12/36, 0   , 0    , 0    , 0    , 16/36, 0    , 0    , 0    , 0   , 8/36 , 0    , # 16
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 0    , 6/36 , 4/36 , 0   , 0    , 3/36 , 0    , 0    , 11/36, 0    , 0    , 0   , 6/36 , 6/36 , # 17
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 6/36 , 4/36 , 0    , 0    , 0    , 14/36, 0    , 0   , 0    , 12/36, # 18
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 0    , 4/36 , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 26/36, 0   , 0    , 6/36 , # 19
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 2/18 , 0    , 0    , 0   , 3/18 , 0    , 0    , 0    , 0    , 0    , 0    , 7/18, 0    , 6/18 , # 20
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , 3/18 , 1/18 , 0    , 0    , 0    , 0   , 11/18, 0    , # 21
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , 2/36 , 0    , 0    , 0    , 3/36 , 0   , 0    , 25/36  # 22
     ), byrow = TRUE, nrow = 22, ncol = 22)


# Probability of starting at each possible state
probabilities <- matrix(c(4/64, # 1
                          2/64, # 2
                          2/64, # 3
                          2/64, # 4
                          2/64, # 5
                          4/64, # 6
                          4/64, # 7
                          1/64, # 8
                          2/64, # 9
                          4/64, # 10
                          4/64, # 11
                          2/64, # 12
                          4/64, # 13
                          4/64, # 14
                          4/64, # 15
                          1/64, # 16
                          4/64, # 17
                          2/64, # 18
                          2/64, # 19
                          2/64, # 20
                          2/64, # 21
                          4/64  # 22
), byrow = FALSE, ncol = 22, nrow = 1)

# Q and probabilities matrices will be rearranged for symmetry and to match 
# what is labeled in 3x2-states.png
Q2 <- Q
Q2[7,] <- Q[8,]
Q2[8,] <- Q[7,]
temp <- Q2
Q2[,7] <- temp[,8]
Q2[,8] <- temp[,7]
Q <- Q2
temp <- probabilities
probabilities[,7] <- temp[,8]
probabilities[,8] <- temp[,7]

ETC <- solve(diag(22) - Q) %*% rep(1,22)

# Theoretical result
probabilities %*% ETC # 18.31765

# Empirical result
set.seed(1)
mean(VM(3,2, 10000)) # 18.1296

# ----- #

# 2x2 model - modified

Q2.2 <- matrix(data = c(1/2,0,1/4,1/4,
                        0,3/4,1/8,1/8,
                        0,3/16,3/4,0,
                        0,3/16,0,3/4),ncol=4,nrow = 4,byrow = T)

ETC2.2 <- solve(diag(4) - Q2.2) %*% rep(1,4)

prob2.2 <- matrix(data = c(2/16,4/16,4/16,4/16), ncol = 4, nrow =1)

# Theoretical Result
prob2.2 %*% ETC2.2 # 25.75

# Empirical Result
mean(noConsensus_time(2,2,100000)) # 25.69059

# ----- #

# 3x2 modified

Q3.2 <- matrix(data =    # 3           # 5           # 7             # 9           # 11          # 13          # 15           # 17          # 19          # 21
      c(185/216, 0     , 0    , 5/72 , 0    , 0    , 0     , 5/108 , 0    , 0    , 0    , 0    , 0    , 0    , 0     , 0    , 0    , 0    , 0    , 0    , 0     , 0      , # 1
        0      , 85/108, 0    , 0    , 0    , 0    , 5/108 , 5/36  , 0    , 0    , 0    , 0    , 0    , 0    , 0     , 0    , 0    , 0    , 0    , 0    , 0     , 0      , # 2
        1/9    , 0     , 19/27, 0    , 0    , 0    , 0     , 0     , 4/54 , 0    , 4/36 , 0    , 0    , 0    , 0     , 0    , 0    , 0    , 0    , 0    , 0     , 0      , # 3
        1/18   , 0     , 0    , 47/54, 0    , 0    , 0     , 0     , 0    , 4/54 , 0    , 0    , 0    , 0    , 0     , 0    , 0    , 0    , 0    , 0    , 0     , 0      , # 4
        1/9    , 0     , 0    , 0    , 19/27, 0    , 0     , 0     , 0    , 0    , 4/36 , 0    , 0    , 4/54 , 0     , 0    , 0    , 0    , 0    , 0    , 0     , 0      , # 5
        1/18   , 1/18  , 0    , 0    , 0    , 35/54, 0     , 0     , 0    , 4/36 , 0    , 0    , 4/54 , 4/72 , 0     , 0    , 0    , 0    , 0    , 0    , 0     , 0      , # 6
        0      , 4/54  , 0    , 0    , 0    , 0    , 19/27 , 0     , 0    , 0    , 0    , 0    , 4/18 , 0    , 0     , 0    , 0    , 0    , 0    , 0    , 0     , 0      , # 7
        2/54   , 2/72  , 0    , 0    , 0    , 0    , 0     , 85/108, 4/72 , 4/72 , 0    , 0    , 4/108, 0    , 0     , 0    , 0    , 0    , 0    , 0    , 0     , 0      , # 8
        0      , 0     , 1/36 , 0    , 0    , 0    , 0     , 1/12  , 7/9  , 0    , 0    , 0    , 0    , 0    , 1/12  , 0    , 0    , 0    , 0    , 1/36 , 0     , 0      , # 9
        0      , 0     , 0    , 1/18 , 0    , 0    , 0     , 1/24  , 0    , 29/36, 0    , 0    , 0    , 0    , 1/24  , 0    , 0    , 0    , 1/18 , 0    , 0     , 0      , # 10
        0      , 0     , 1/24 , 1/12 , 1/24 , 0    , 0     , 0     , 0    , 0    , 17/24, 0    , 0    , 0    , 1/18  , 1/24 , 1/36 , 0    , 0    , 0    , 0     , 0      , # 11
        0      , 0     , 1/12 , 0    , 0    , 1/6  , 0     , 0     , 0    , 0    , 0    , 1/2  , 0    , 0    , 0     , 0    , 1/6  , 0    , 0    , 1/12 , 0     , 0      , # 12
        0      , 0     , 0    , 0    , 0    , 1/36 , 1/24  , 1/18  , 0    , 0    , 0    , 0    , 17/24, 0    , 0     , 0    , 0    , 1/24 , 1/12 , 1/24 , 0     , 0      , # 13
        0      , 0     , 0    , 0    , 1/18 , 1/24 , 0     , 1/12  , 0    , 0    , 0    , 0    , 0    , 23/36, 1/12  , 0    , 1/24 , 1/18 , 0    , 0    , 0     , 0      , # 14
        0      , 0     , 0    , 0    , 0    , 0    , 0     , 0     , 4/72 , 4/72 , 4/108, 0    , 0    , 0    , 85/108, 0    , 0    , 0    , 0    , 0    , 2/72  , 2/54   , # 15
        0      , 0     , 0    , 0    , 0    , 0    , 0     , 0     , 0    , 0    , 4/18 , 0    , 0    , 0    , 0     , 19/27, 0    , 0    , 0    , 0    , 4/54  , 0      , # 16
        0      , 0     , 0    , 0    , 0    , 0    , 0     , 0     , 0    , 4/36 , 4/54 , 0    , 0    , 4/72 , 0     , 0    , 35/54, 0    , 0    , 0    , 1/18  , 1/18   , # 17
        0      , 0     , 0    , 0    , 0    , 0    , 0     , 0     , 0    , 0    , 0    , 0    , 4/36 , 4/54 , 0     , 0    , 0    , 19/27, 0    , 0    , 0     , 1/9    , # 18
        0      , 0     , 0    , 0    , 0    , 0    , 0     , 0     , 0    , 4/54 , 0    , 0    , 0    , 0    , 0     , 0    , 0    , 0    , 47/54, 0    , 0     , 1/18   , # 19
        0      , 0     , 0    , 0    , 0    , 0    , 0     , 0     , 4/54 , 0    , 0    , 0    , 4/36 , 0    , 0     , 0    , 0    , 0    , 0    , 19/27, 0     , 1/9    , # 20
        0      , 0     , 0    , 0    , 0    , 0    , 0     , 0     , 0    , 0    , 0    , 0    , 0    , 0    , 5/36  , 5/108, 0    , 0    , 0    , 0    , 85/108, 0      , # 21
        0      , 0     , 0    , 0    , 0    , 0    , 0     , 0     , 0    , 0    , 0    , 0    , 0    , 0    , 5/108 , 0    , 0    , 0    , 5/72 , 0    , 0     , 185/216  # 22
        ), byrow = TRUE, nrow = 22, ncol = 22)


ETC3.2 <- solve(diag(22) - Q3.2) %*% rep(1,22)

# theoretical result
probabilities %*% ETC3.2 # 160.3006

# empirical result
set.seed(1)
mean(noConsensus_time(3,2,10000)) # 159.7298
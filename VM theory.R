# The following calculations are on the expected time to absorption of a 3x2 classic voter model
# The purpose of this calculation is to confirm the validity of the empirical results the algorithm produces, that way,
# the algorithm may be revised to fit alternative models without concern for implementation error.

# For reference of which states are associated with which value, see states.pdf

# Prerequisites
source("Voter model simulations.R")

# Extract Q matrix from our transition matrix
Q <- matrix(data = # 3          # 5          # 7           # 9           # 11         # 13          # 15          # 17          # 19         # 21
   c(25/36, 0    , 0   , 3/36 , 0   , 0    , 2/36 , 0    , 0    , 0    , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 1
     0    , 11/18, 0   , 0    , 0   , 0    , 3/18 , 1/18 , 0    , 0    , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 2
     6/18 , 0    , 7/18, 0    , 0   , 0    , 0    , 0    , 2/18 , 0    , 3/18 , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 3
     3/18 , 0    , 0   , 13/18, 0   , 0    , 0    , 0    , 0    , 2/18 , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 4
     6/18 , 0    , 0   , 0    , 7/18, 0    , 0    , 0    , 0    , 0    , 3/18 , 0   , 0    , 2/18 , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 5
     6/36 , 6/36 , 0   , 0    , 0   , 11/36, 0    , 0    , 0    , 6/36 , 0    , 0   , 4/36 , 3/36 , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 6
     4/36 , 3/36 , 0   , 0    , 0   , 0    , 21/36, 0    , 3/36 , 3/36 , 0    , 0   , 2/36 , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 7
     0    , 2/9  , 0   , 0    , 0   , 0    , 0    , 16/36, 0    , 0    , 0    , 0   , 1/3  , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , # 8
     0    , 0    , 1/18, 0    , 0   , 0    , 3/18 , 0    , 10/18, 0    , 0    , 0   , 0    , 0    , 3/18 , 0    , 0    , 0    , 0    , 1/18, 0    , 0    , # 9
     0    , 0    , 0   , 4/36 , 0   , 0    , 3/36 , 0    , 0    , 22/36, 0    , 0   , 0    , 0    , 3/36 , 0    , 0    , 0    , 4/36 , 0   , 0    , 0    , # 10
     0    , 0    , 3/36, 6/36 , 3/36, 0    , 0    , 0    , 0    , 0    , 15/36, 0   , 0    , 0    , 4/36 , 3/36 , 2/36 , 0    , 0    , 0   , 0    , 0    , # 11
     0    , 0    , 1/6 , 0    , 0   , 2/6  , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , 0    , 0    , 2/6  , 0    , 0    , 1/6 , 0    , 0    , # 12
     0    , 0    , 0   , 0    , 0   , 2/36 , 4/36 , 3/36 , 0    , 0    , 0    , 0   , 15/36, 0    , 0    , 0    , 0    , 3/36 , 6/36 , 3/36, 0    , 0    , # 13
     0    , 0    , 0   , 0    , 4/36, 3/36 , 6/36 , 0    , 0    , 0    , 0    , 0   , 0    , 10/36, 6/36 , 0    , 3/36 , 4/36 , 0    , 0   , 0    , 0    , # 14
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 3/36 , 3/36 , 2/36 , 0   , 0    , 0    , 21/36, 0    , 0    , 0    , 0    , 0   , 3/36 , 4/36 , # 15
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 12/36, 0   , 0    , 0    , 0    , 16/36, 0    , 0    , 0    , 0   , 8/36 , 0    , # 16
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 0    , 6/36 , 4/36 , 0   , 0    , 3/36 , 0    , 0    , 11/36, 0    , 0    , 0   , 6/36 , 6/36 , # 17
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 6/36 , 4/36 , 0    , 0    , 0    , 14/36, 0    , 0   , 0    , 12/36, # 18
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 0    , 4/36 , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 26/36, 0   , 0    , 6/36 , # 19
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 2/18 , 0    , 0    , 0   , 3/18 , 0    , 0    , 0    , 0    , 0    , 0    , 7/18, 0    , 6/18 , # 20
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , 3/18 , 1/18 , 0    , 0    , 0    , 0   , 11/18, 0    , # 21
     0    , 0    , 0   , 0    , 0   , 0    , 0    , 0    , 0    , 0    , 0    , 0   , 0    , 0    , 2/36 , 0    , 0    , 0    , 3/36 , 0   , 0    , 25/36  # 22
     ), byrow = TRUE, nrow = 22, ncol = 22)

# Extract R matrix from our transition matrix
R <- matrix(data = 
              c( 6/36, 0,
                 3/18, 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 0,
                 0   , 3/18,
                 0   , 6/36
              ), byrow = TRUE, nrow = 22, ncol = 2)

# Probability of starting at each possible state
probabilities <- matrix(c(4/64, # 1
                          2/64, # 2
                          2/64, # 3
                          2/64, # 4
                          2/64, # 5
                          4/64, # 6
                          4/64, # 7
                          1/64, # 8
                          2/64, # 9
                          4/64, # 10
                          4/64, # 11
                          2/64, # 12
                          4/64, # 13
                          4/64, # 14
                          4/64, # 15
                          1/64, # 16
                          4/64, # 17
                          2/64, # 18
                          2/64, # 19
                          2/64, # 20
                          2/64, # 21
                          4/64  # 22
), byrow = FALSE, ncol = 22, nrow = 1)

# Q and Probabilities matricies will be rearranged for symmetry
Q2 <- Q
Q2[7,] <- Q[8,]
Q2[8,] <- Q[7,]

temp <- Q2


Q2[,7] <- temp[,8]
Q2[,8] <- temp[,7]

Q <- Q2

temp <- probabilities

probabilities[,7] <- temp[,8]
probabilities[,8] <- temp[,7]

# Theoretical result
ETC <- solve(diag(22) - Q) %*% rep(1,22)
# mat <-solve(diag(22) - Q) %*% R

probabilities %*% ETC # 18.31765

# Empirical result
mean(VM(3,2, 10000)) # 18.3367